#!/bin/sh

# **
# clean orphans and other cache stuff
# *

# *****************************************************************************
# preamble
# *****************************************************************************
# source utility functions
. ./utils

# check if running with elevated privileges
check_su

# *****************************************************************************
# main
# *****************************************************************************
# arch-based
[ -x "$(command -v "pacman")" ] && {
    # display cached packages
    printf "amount of cached packages: %s | size: %s\n" \
        "$(find /var/cache/pacman/pkg | wc -l)" \
        "$(du -hs /var/cache/pacman/pkg)"

    # clear ~/.cache folder
    rm -fr "$HOME"/.cache/

    # clear pkg cache
    pacman -Scc
    paccache -r

    # clear orphans
    pacman -Rns --noconfirm $(pacman -Qdqt)

    # display cached packages after
    printf "amount of cached packages: %s | size: %s\n" \
        "$(find /var/cache/pacman/pkg | wc -l)" \
        "$(du -hs /var/cache/pacman/pkg)"
}

# void
[ -x "$(command -v "xbps-install")" ] && {
    # display cached packages
    printf "amount of cached packages: %s | size: %s\n" \
        "$(find /var/cache/xbps | wc -l)" "$(du -hs /var/cache/xbps)"

    # clear ~/.cache folder
    rm -fr "$HOME"/.cache/

    # clear pkg cache
    xbps-remove -FORfovy
    # clear old kernels
    vkpurge rm all

    # display cached packages after
    printf "amount of cached packages: %s | size: %s\n" \
        "$(find /var/cache/xbps | wc -l)" "$(du -hs /var/cache/xbps)"
}
