#!/bin/sh

# **
# clean orphans and other cache stuff
# *

# -----------------------------------------------------------------------------
# preamble
# -----------------------------------------------------------------------------

# source utility functions
. utils

# check if running with elevated privileges
check_su

# -----------------------------------------------------------------------------
# functions
# -----------------------------------------------------------------------------

clear_cache() {
    CACHE_FOLDER="$HOME/.cache"
    [ -d "$CACHE_FOLDER" ] && rm -fr "$CACHE_FOLDER"
}

print_cached_pkgs() {
    case $1 in
    arch) CACHED_PKGS_FOLDER="/var/cache/pacman/pkg" ;;
    void) CACHED_PKGS_FOLDER="/var/cache/xbps" ;;
    esac

    printf "amount of cached packages: %s | size: %s\n" \
        "$(find $CACHED_PKGS_FOLDER | wc -l)" \
        "$(du -hs $CACHED_PKGS_FOLDER)"
}

# -----------------------------------------------------------------------------
# main
# -----------------------------------------------------------------------------

# clear ~/.cache folder
clear_cache

# arch-based
[ -x "$(command -v "pacman")" ] && {
    # display cached packages
    print_cached_pkgs "arch"

    # clear pkg cache
    pacman -Scc
    paccache -r

    # clear orphans
    pacman -Rns --noconfirm $(pacman -Qdqt)

    # display cached packages after
    print_cached_pkgs "arch"
}

# void
[ -x "$(command -v "xbps-install")" ] && {
    # display cached packages
    print_cached_pkgs "xbps"

    # clear pkg cache
    xbps-remove -FORfovy
    # clear old kernels
    vkpurge rm all

    # display cached packages after
    print_cached_pkgs "xbps"
}
