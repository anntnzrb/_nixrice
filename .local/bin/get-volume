#!/bin/sh

# **
# get volume level
#
# currently only working for pulseaudio
# *

# -----------------------------------------------------------------------------
# preamble
# -----------------------------------------------------------------------------

# load utilities
# shellcheck disable=1090
. "$LIBSHUTILS/std-utils"

# -----------------------------------------------------------------------------
# main
# -----------------------------------------------------------------------------

is_installed 'pulseaudio' && {
    # get pulseaudio info
    VOL_STAT="$(pactl list sinks)"

    # get volume value
    VOL="$(echo "$VOL_STAT" | grep '[0-9]\+%' | sed "s,.* \([0-9]\+\)%.*,\1,;1q")"

    # check if muted
    echo "$VOL_STAT" | grep -q "Mute: yes" && printf "ðŸ”‡\\n" && exit 0

    if [ "$VOL" -gt "70" ]; then
        icon="ðŸ”Š"
    elif [ "$VOL" -lt "30" ]; then
        icon="ðŸ”ˆ"
    else
        icon="ðŸ”‰"
    fi

    printf "%s %s%%" "$icon" "$VOL"
} || printf 'ðŸ”Š???\n'
