#!/bin/sh

# runemacs --- <desc>

# Commentary:

# <desc>

# Code:

# shellcheck disable=SC2006,SC2312

# -----------------------------------------------------------------------------
# functions
# -----------------------------------------------------------------------------

err() {
    printf '%s\n' "${@}" >&2
}

abort() {
    err "${@}"; exit 1
}

installedp() {
    test -x "`command -v "${1}"`"
}

terminalp() {
    tty >/dev/null 2>&1
}

emacs_running_p() {
    pidof 'emacs' >/dev/null
}

emacs_start_daemon() {
    printf 'Starting GNU Emacs daemon...' && emacs --daemon
}

emacs_exec_client() {
    exec emacsclient "${@}"
}

# -----------------------------------------------------------------------------
# main
# -----------------------------------------------------------------------------

# check if Emacs is even installed...
installedp 'emacs' || abort 'Emacs is not even installed...'

# run the Emacs daemon if it is not already
emacs_running_p || emacs_start_daemon

# now, when it is running...
emacs_running_p && {
    # handle Emacs via the terminal
    terminalp && emacs_exec_client -nw "${@}"

    # otherwise just create a new graphical frame
    emacs_exec_client -c "${@}"
}
