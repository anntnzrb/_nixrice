#!/bin/sh

# **
# get volume level
#
# currently only working for pulseaudio
# *

# checks
! installedp 'pactl' && err "'pactl' is needed for this script" && exit 1
test ${#} -ne 0 && err 'This script takes no arguments' && exit 1

if runningp 'pulseaudio' || runningp 'pipewire'; then
    # get pulseaudio info
    volstat="`pactl list sinks`"

    # get volume value
    vol="`echo "${volstat}" | grep '[0-9]\+%' | sed "s,.* \([0-9]\+\)%.*,\1,;1q"`"

    # check if muted
    printf '%s' "${volstat}" | grep -q "Mute: yes" && printf 'ðŸ”‡\n' && exit 0

    if test ${vol} -gt 70; then
        icon="ðŸ”Š"
    elif test ${vol} -lt 30; then
        icon="ðŸ”ˆ"
    else
        icon="ðŸ”‰"
    fi

    printf "%s %s%%" "${icon}" "${vol}"
else
    printf 'ðŸ”Š???\n'
fi

exit 0
